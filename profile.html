<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UnityPass Profile</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>UnityPass Lookup</h1>
    <p>Enter phone number to see worker identity</p>
  </header>

  <main>
    <input type="text" id="phoneInput" placeholder="Enter Phone Number">
    <button id="findBtn">Find Worker</button>

    <div id="profileContainer"></div>
  </main>

  <script src="js/qrcode.min.js"></script>
  <script src="js/jspdf.umd.min.js"></script>
  <script>
    const API_URL = 'https://api.sheetbest.com/sheets/6370568b-e4ec-43f3-b14d-13875e2b5bfe';
    const phoneInput = document.getElementById('phoneInput');
    const findBtn = document.getElementById('findBtn');
    const container = document.getElementById('profileContainer');

    let workers = [];

    async function loadWorkers() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        workers = Array.isArray(data) ? data : [];
      } catch(err) {
        container.innerHTML = '<p style="color:red">Failed to load workers.</p>';
      }
    }

    function displayWorker(w) {
      container.innerHTML = '';
      if(!w) {
        container.innerHTML = '<p style="color:#666">Worker not found.</p>';
        return;
      }

      const card = document.createElement('div');
      card.className = 'id-card';
      const safeId = (w.Name || 'no-name').replace(/\s+/g,'_');
      card.innerHTML = `
        <h2>${w.Name || ''}</h2>
        <p><strong>Skill:</strong> ${w.Skill || ''}</p>
        <p><strong>Phone:</strong> ${w.Phone || ''}</p>
        <p><strong>Location:</strong> ${w.Location || ''}</p>
        <div class="qr-code" id="qr-${safeId}"></div>
        <button id="downloadBtn">Download PDF</button>
      `;
      container.appendChild(card);

      new QRCode(document.getElementById(`qr-${safeId}`), {
        text: `Name: ${w.Name}\nSkill: ${w.Skill}\nPhone: ${w.Phone}\nLocation: ${w.Location}`,
        width: 120,
        height: 120
      });

      document.getElementById('downloadBtn').addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ unit: 'mm', format: 'a6' });
        doc.setFontSize(14);
        doc.text(`Name: ${w.Name}`, 10, 20);
        doc.setFontSize(12);
        doc.text(`Skill: ${w.Skill}`, 10, 30);
        doc.text(`Phone: ${w.Phone}`, 10, 40);
        doc.text(`Location: ${w.Location}`, 10, 50);
        doc.save(`${w.Name}_UnityPass.pdf`);
      });
    }

    findBtn.addEventListener('click', () => {
      const phone = phoneInput.value.trim();
      if(!phone) return;
      const worker = workers.find(w => w.Phone === phone);
      displayWorker(worker);
    });

    loadWorkers();
  </script>
</body>
</html>